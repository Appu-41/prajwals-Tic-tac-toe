import { useEffect, useState, useRef } from "react";
import { Bot, Sparkles } from "lucide-react";

type MessageType = "win" | "lose" | "draw" | "thinking" | "your_turn" | "game_start" | "idle";

interface AIMessageProps {
  type: MessageType;
  aiWins: number;
  playerWins: number;
}

const messages = {
  win: [
    "à²à²¨à³?! à²¹à³‡à²—à³† à²®à²¾à²¡à²¿à²¦à³†... à²¸à²°à²¿, à²¨à²¿à²¨à³à²¨ à²—à³Œà²°à²µà²¿à²¸à³à²¤à³€à²¨à²¿! ðŸ¤¯",
    "à²…à²¸à²¾à²§à³à²¯! à²¨à³€à²¨à³ Tic Tac Toe à²œà³€à²¨à²¿à²¯à²¸à³! à²®à²¤à³à²¤à³† à²†à²¡à³‹à²£?",
    "à²¨à²¿à²¨à²—à³† à²¨à²®à²¸à³à²•à²¾à²°, à²®à²¾à²¸à³à²Ÿà²°à³! à²…à²¦à³à²­à³à²¤à²µà²¾à²—à²¿à²¤à³à²¤à³! ðŸ‘‘",
    "à²¤à²¡à²¿... à²¨à²¾à²¨à³ à²¸à³‹à²¤à³†à²¨à²¾? à²‡à²¦à³ à²†à²—à²²à³à²²! ðŸ˜±",
    "à²¸à²°à²¿ à²¸à²°à²¿, à²¨à²¿à²¨à³à²¨ à²…à²¦à³ƒà²·à³à²Ÿ! à²®à²¤à³à²¤à³† à²†à²¡à³‹à²£! ðŸ€",
  ],
  lose: [
    "ðŸ¤– à²²à³†à²•à³à²• à²¹à²¾à²•à²¿à²¦à³à²¦à³†! à²¨à²¨à³à²¨ à²¸à³‹à²²à²¿à²¸à³à²¤à³€à²¯ à²…à²‚à²¤ à²…à²‚à²¦à³à²•à³Šà²‚à²¡à³à²¯à²¾?",
    "AI à²¦à³Šà²°à³†à²—à³† à²¨à²®à²¸à³à²•à²¾à²° à²¹à²¾à²•à³! ðŸ‘‘ à²¤à²®à²¾à²·à³†... à²‡à²²à³à²²à²µà³‹?",
    "à²¤à³à²‚à²¬à²¾ à²¸à³à²²à²­! à²¨à²¾à²¨à³ à²…à²¨à³â€Œà²¬à³€à²Ÿà²¬à²²à³! ðŸ’ª",
    "à²®à³à²¹à²¾à²¹à²¾à²¹à²¾! à²¯à²‚à²¤à³à²° à²¯à²¾à²µà²¾à²—à²²à³‚ à²—à³†à²²à³à²²à³à²¤à³à²¤à³†! ðŸŽ®",
    "GG EZ! à²¨à²¿à²¨à²—à³† à²¸à³à²²à²­ à²®à²¾à²¡à³à²²à²¾? ðŸ˜",
    "à²…à²¦à³ à²¨à²¿à²¨à³à²¨ à²¬à³†à²¸à³à²Ÿà³ à²®à³‚à²µà³ à²†à²—à²¿à²¤à³à²¤à²¾? à²¨à²¿à²œà²µà²¾à²—à²¿? ðŸ™„",
    "à²•à²²à³à²²à²¿à²—à²¿à²‚à²¤ à²•à³†à²Ÿà³à²Ÿ à²†à²Ÿ à²¨à³‹à²¡à²¿à²¦à³à²¦à³€à²¨à²¿! ðŸª¨",
    "à²ªà³à²°à²¯à²¤à³à²¨ à²®à²¾à²¡à³à²¤à²¿à²¦à³à²¦à³€à²¯à²¾ à²†à²¦à³à²°à³‚? à² à²¬à²¾à²°à³‹! ðŸ˜‚",
    "à²¨à²¨à³à²¨ à²…à²œà³à²œà²¿ à²¨à²¿à²¨à²—à²¿à²‚à²¤ à²šà³†à²¨à³à²¨à²¾à²—à²¿ à²†à²¡à³à²¤à²¾à²°à³†! ðŸ‘µ",
    "à²•à³à²²à²¿à²•à³ à²®à²¾à²¡à³‹ à²®à³à²‚à²šà³† à²•à²£à³à²£à³ à²®à³à²šà³à²•à³Šà²‚à²¡à²¿à²¦à³à²¯à²¾? ðŸ‘€",
    "à²¨à³‹à²¡à³‹à²•à³† à²¨à³‹à²µà²¾à²—à³à²¤à²¿à²¤à³à²¤à³... à²¨à²¿à²¨à²—à³†! ðŸ˜ˆ",
    "à²®à²¤à³à²¤à³Šà²¬à³à²¬ à²§à³‚à²³à²¿à²—à³† à²¬à²¿à²¦à³à²¦! ðŸŽµ",
    "à²…à²¦à³ strategy à²…à²‚à²¤à³€à²¯à²¾? à²•à³à²¯à³‚à²Ÿà³! ðŸ¥±",
    "10 à²®à³‚à²µà³à²¸à³ à²®à³à²‚à²šà³†à²¨à³‡ à²Šà²¹à²¿à²¸à²¿à²¦à³à²¦à³†! ðŸ”®",
    "à²Ÿà³à²µà²¿à²¸à³à²Ÿà³: à²¨à³€à²¨à³ à²®à²¤à³à²¤à³† à²¸à³‹à²¤à³†! ðŸ“–",
    "à²®à³Šà²¦à²² à²¸à²² à²†à²¡à³à²¤à²¿à²¦à³à²¦à³€à²¯à²¾? à²¹à³‡à²³à³ à²¨à²¿à²œ! ðŸ¤”",
    "à²ªà³à²°à²¯à²¤à³à²¨ à²®à²¾à²¡à³, à²¨à³‹à²¡à³‹à²•à³† à²®à²œà²¾ à²¬à²°à³à²¤à²¿à²¦à³†! ðŸ¿",
    "à²¨à²¨à²—à³† à²¤à³à²‚à²¬à²¾ à²¸à³à²²à²­ à²®à²¾à²¡à³à²¤à²¿à²¦à³à²¦à³€à²¯! ðŸ˜Ž",
    "à²šà³†à²•à²°à³à²¸à³ à²†à²¡à³ à²¹à³‹à²—à³? ðŸŽ¯",
    "L + ratio + à²¨à³€à²¨à³ à²¬à²¿à²¦à³à²¦à³† + à²¨à²¾à²¨à³ à²¬à³†à²¸à³à²Ÿà³ ðŸ’€",
    "à²¸à³à²•à²¿à²²à³ à²‡à²¶à³à²¯à³‚ à²‡à²¦à³† à²¨à²¿à²¨à²—à³†! ðŸš¨",
    "à²¬à³‡à²°à³† à²¹à²µà³à²¯à²¾à²¸ à²®à²¾à²¡à³ à²…à²‚à²¤ à²¯à³‹à²šà²¨à³† à²®à²¾à²¡à²¿à²¦à³à²¯à²¾? ðŸŽ¨",
    "à²¨à²¨à²—à³† à²¬à³‡à²œà²¾à²°à²¾à²—à³à²¤à²¿à²¤à³à²¤à³... à²†à²—à³à²²à²¿à²²à³à²²! ðŸ˜",
    "à²¨à²¿à²¨à³à²¨ à²®à³‚à²µà³ à²¤à³à²‚à²¬à²¾ à²•à³†à²Ÿà³à²Ÿà²¦à²¾à²—à²¿à²¤à³à²¤à³, à²¬à²—à³ à²…à²‚à²¦à³à²•à³Šà²‚à²¡à³†! ðŸ›",
    "à²¬à³‡à²°à³† à²¯à²¾à²°à²¾à²¦à³à²°à³‚ à²Ÿà³à²°à³ˆ à²®à²¾à²¡à³à²¤à²¾à²°à²¾? ðŸ‘‹",
  ],
  draw: [
    "à²¡à³à²°à²¾?! à²…à²¦à³à²­à³à²¤ à²¡à²¿à²«à³†à²¨à³à²¸à³! ðŸ›¡ï¸",
    "à²¬à²¦à³à²•à²¿à²•à³Šà²‚à²¡à³†! à²¹à³†à²šà³à²šà²¿à²¨à²µà²°à²¿à²—à³† à²¡à³à²°à²¾ à²•à³‚à²¡ à²†à²—à²²à³à²²! ðŸ’ª",
    "à²¹à³à²®à³à²®à³, à²¸à³à²Ÿà³‡à²²à³â€Œà²®à³‡à²Ÿà³. à²¨à²¾à²¨à³ à²…à²‚à²¦à³à²•à³Šà²‚à²¡à²¿à²¦à³à²¦à²•à³à²•à²¿à²‚à²¤ à²•à²·à³à²Ÿ à²¨à³€à²¨à³! ðŸ¤”",
    "à²¯à²¾à²°à³‚ à²—à³†à²²à³à²²à²²à²¿à²²à³à²²... à²ˆ à²¸à²²! à²®à²¤à³à²¤à³† à²†à²¡à³‹à²£? ðŸ¤",
  ],
  thinking: [
    "à²¬à³†à²¸à³à²Ÿà³ strategy à²¯à³‹à²šà²¿à²¸à³à²¤à²¿à²¦à³à²¦à³€à²¨à²¿... ðŸ¤–",
    "Minimax algorithm à²°à²¨à³ à²†à²—à³à²¤à²¿à²¦à³†... ðŸ’»",
    "à²¨à²¿à²¨à³à²¨ à²¸à³‹à²²à³ à²²à³†à²•à³à²• à²¹à²¾à²•à³à²¤à²¿à²¦à³à²¦à³€à²¨à²¿... âš™ï¸",
    "à²Žà²²à³à²²à²¾ à²­à²µà²¿à²·à³à²¯à²—à²³à²¨à³à²¨à³ à²¨à³‹à²¡à³à²¤à²¿à²¦à³à²¦à³€à²¨à²¿... ðŸ”®",
  ],
  your_turn: [
    "à²¨à²¿à²¨à³à²¨ à²¸à²°à²¦à²¿. à²šà³†à²¨à³à²¨à²¾à²—à²¿ à²†à²¡à³. ðŸŽ¯",
    "à²œà²¾à²—à³à²°à²¤à³†à²¯à²¾à²—à²¿ à²†à²°à²¿à²¸à³... à²Žà²²à³à²²à²¾ à²¨à³‹à²¡à³à²¤à³€à²¨à²¿. ðŸ‘ï¸",
    "à²†à²¡à³, à²¤à²ªà³à²ªà³ à²®à²¾à²¡à³. à²•à²¾à²¯à³à²¤à²¿à²¦à³à²¦à³€à²¨à²¿. ðŸ˜ˆ",
    "à²¨à²¿à²¨à³à²¨ à²®à³‚à²µà³. à²…à²¦à²°à²¿à²‚à²¦ à²à²¨à³‚ à²†à²—à²²à³à²²... ðŸ¥±",
  ],
  game_start: [
    "à²¤à²¯à²¾à²°à²¾à²—à³. à²¸à³à²²à²­ à²†à²—à²²à³à²². ðŸ¤–",
    "à²šà²¾à²²à³†à²‚à²œà³ à²’à²ªà³à²ªà²¿à²•à³Šà²‚à²¡à³†. à²¶à³à²°à³ à²®à²¾à²¡à³. âš”ï¸",
    "à²¸à³‹à²²à³‹à²•à³† à²°à³†à²¡à²¿à²¨à²¾? à²¨à³€à²¨à³ à²®à³Šà²¦à²²à³! ðŸ˜",
    "à²à²¨à³ à²®à²¾à²¡à³à²¤à³€à²¯ à²¨à³‹à²¡à³‹à²£! à²¸à²¾à²•à²¾à²—à²²à³à²² à²…à²‚à²¤ à²—à³Šà²¤à³à²¤à³! ðŸ’ª",
  ],
  idle: [
    "*à²ªà³à²¯à²¾à²Ÿà²°à³à²¨à³ à²…à²¨à²²à³ˆà²¸à³ à²®à²¾à²¡à³à²¤à²¿à²¦à³à²¦à³€à²¨à²¿* ðŸ¤–",
    "*à²ªà³à²°à²¾à²¬à²¬à²¿à²²à²¿à²Ÿà²¿ à²²à³†à²•à³à²• à²¹à²¾à²•à³à²¤à²¿à²¦à³à²¦à³€à²¨à²¿* ðŸ“Š",
    "*à²¨à²¿à²¨à³à²¨ à²®à³à²‚à²¦à²¿à²¨ 5 à²¤à²ªà³à²ªà³à²—à²³à²¨à³à²¨à³ à²Šà²¹à²¿à²¸à³à²¤à²¿à²¦à³à²¦à³€à²¨à²¿* ðŸ”®",
  ],
};

const getStreakMessage = (aiWins: number, playerWins: number): string | null => {
  if (aiWins >= 3) {
    const streakMessages = [
      `${aiWins} à²¸à²¤à²¤ à²—à³†à²²à³à²µà³! à²¨à²¾à²¨à³ à²…à²¨à²¿à²µà²¾à²°à³à²¯! ðŸ†`,
      `${aiWins} à²—à³†à²²à³à²µà³! à²•à²£à³à²£à³ à²®à³à²šà³à²•à³Šà²‚à²¡à³ à²†à²¡à³à²²à²¾? ðŸ™ˆ`,
      `${aiWins} à²—à³†à²²à³à²µà³! à²¬à³‡à²œà²¾à²°à²¾à²—à³à²¤à²¿à²¦à³†... à²‡à²²à³à²²! ðŸ˜‚`,
      `${aiWins} à²µà²¿à²•à³à²Ÿà²°à²¿! à²¨à³€à²¨à³ à²¨à²¨à³à²¨ à²«à³‡à²µà²°à²¿à²Ÿà³ punching bag! ðŸ¥Š`,
    ];
    return streakMessages[Math.floor(Math.random() * streakMessages.length)];
  }
  if (playerWins >= 3) {
    return `${playerWins} à²—à³†à²²à³à²µà³?! à²šà³€à²Ÿà²¿à²‚à²—à³ à²®à²¾à²¡à³à²¤à²¿à²¦à³à²¦à³€à²¯à²¾?! à²®à²¤à³à²¤à³† à²†à²¡à³! ðŸ˜±`;
  }
  return null;
};

const AIMessage = ({ type, aiWins, playerWins }: AIMessageProps) => {
  const [message, setMessage] = useState("");
  const [isAnimating, setIsAnimating] = useState(false);
  const usedMessagesRef = useRef<Record<string, Set<number>>>({});

  useEffect(() => {
    const streakMessage = getStreakMessage(aiWins, playerWins);
    if (streakMessage && (type === "win" || type === "lose")) {
      setMessage(streakMessage);
    } else {
      const messageList = messages[type];
      
      // Initialize used messages set for this type if not exists
      if (!usedMessagesRef.current[type]) {
        usedMessagesRef.current[type] = new Set();
      }
      
      // Reset if all messages have been used
      if (usedMessagesRef.current[type].size >= messageList.length) {
        usedMessagesRef.current[type].clear();
      }
      
      // Find an unused message
      let randomIndex: number;
      do {
        randomIndex = Math.floor(Math.random() * messageList.length);
      } while (usedMessagesRef.current[type].has(randomIndex));
      
      usedMessagesRef.current[type].add(randomIndex);
      setMessage(messageList[randomIndex]);
    }
    setIsAnimating(true);
    const timer = setTimeout(() => setIsAnimating(false), 300);
    return () => clearTimeout(timer);
  }, [type, aiWins, playerWins]);

  return (
    <div className={`flex items-start gap-3 p-4 rounded-2xl bg-card shadow-lg transition-all duration-300 ${
      isAnimating ? "scale-105" : "scale-100"
    }`}>
      <div className="flex-shrink-0 w-10 h-10 rounded-full bg-gradient-to-br from-game-pink to-game-sky flex items-center justify-center">
        {type === "thinking" ? (
          <Sparkles className="w-5 h-5 text-white animate-spin" />
        ) : (
          <Bot className="w-5 h-5 text-white" />
        )}
      </div>
      <div className="flex-1">
        <p className="text-sm font-medium text-muted-foreground mb-1">
          AI Opponent (Hard Mode)
        </p>
        <p className="text-foreground font-medium">{message}</p>
      </div>
    </div>
  );
};

export default AIMessage;
export type { MessageType };
